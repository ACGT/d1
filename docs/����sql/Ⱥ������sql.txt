select * from smssndmst

1.先向smssndmst表中写入要发的短信内容
2.向smssnddtl表中写入一条测试手机号信息
3.测试无误，按发短信的规则导入手机号信息到smssnddtl表中
4.下发短信
5.记录发信息成功数到effectsms 

select top 10 * from smssndmst order by smsid desc

insert into smssndmst(content)
select '国庆大促5宗最:最美价期兰芝4件套39元,最大牌2折起,最新潮品卡西欧5折起,最爱抱团雅顿唇膏69,最佳积会纯牛皮钱包免费换,速见d1.cn'

---update smssndmst set '国庆大促5宗最:最美价期兰芝4件套39元,最大牌2折起,最新潮品卡西欧5折起,最爱抱团雅顿唇膏69,最佳积会纯牛皮钱包免费换速见d1.cn'
-- where smsid=264

select count(*) from smssnddtl where smsid=263 and ifsend=1

 
--delete from smssnddtl where smsid=264 and phone='15011462232'


insert into smssnddtl (smsid,phone,mbrid,name)
select 264,'15011462232',8,'gao'


--给买过特定商品的人发短信 
insert into smssnddtl (smsid,phone,mbrid,name,ifsend) 
select DISTINCT 264,odrmst_rphone,max(odrmst_mbrid),max(odrmst_rname),-1 from  odrmst_recent,odrdtl_recent 
where odrmst_odrid=odrdtl_odrid and len(odrmst_rphone)=11 
and (odrmst_rphone like '13%' or odrmst_rphone like '15%' or odrmst_rphone like '18%') 
and odrmst_mbrid not in(select mbrmstpingan_mbrid from mbrmstpingan) 
and odrmst_orderdate>='2011-4-1' --and odrmst_orderdate<='2011-4-1' --and (odrdtl_rackcode like '014%') 
--and odrdtl_gdsname like '%贝佳斯%'
 and (odrdtl_gifttype='' or odrdtl_gifttype is null) 
and odrdtl_finalprice>1 and odrdtl_shipstatus=3 and odrmst_orderstatus in (3,31,5,51,6,61) 
and odrmst_rphone not in(select phone from badsms) 
and odrmst_mbrid not in (select mbrspe_mbrid from mbrspe)
group by odrmst_rphone 


insert into smssnddtl (smsid,phone,mbrid,name,ifsend) 
select  264,odrmst_rphone,odrmst_mbrid,odrmst_rname,-1 
from d1marketing..sms110919
 where len(odrmst_rphone)=11 
and (odrmst_rphone like '13%' or odrmst_rphone like '15%' or odrmst_rphone like '18%') 

select * into d1marketing..sms110919 from (
select DISTINCT odrmst_rphone,max(odrmst_mbrid) odrmst_mbrid,max(odrmst_rname) odrmst_rname
from  dba.odrmst_history,dba.odrdtl_history
where odrmst_odrid=odrdtl_odrid
and odrmst_mbrid not in(select mbrmstpingan_mbrid from mbrmstpingan) 
and odrmst_orderdate>='2011-4-1' --and odrmst_orderdate<='2010-5-8' and (odrdtl_rackcode like '014%') 
--and odrdtl_gdsname like '%贝佳斯%'
 and (odrdtl_gifttype='' or odrdtl_gifttype is null) 
and odrdtl_finalprice>1 and odrdtl_shipstatus=3 and odrmst_orderstatus in (3,31,5,51,6,61) 
and odrmst_rphone not in(select phone from badsms) 
and odrmst_mbrid not in (select mbrspe_mbrid from mbrspe)
and odrmst_rphone not in (select phone from smssnddtl where smsid=264) --!!!!!!!!!!!!!!!!!!!!!1
group by odrmst_rphone )a


select count(*) from smssndmst where smsid=263


SELECT *FROM .[effectsms]

insert into effectsms 
(effectsms_content,effectsms_userdetail,effectsms_allusercount,effectsms_startdate,effectsms_tktvalue,effectsms_tkttitle)

select content,'1、10年注册购物-近4个月之前的客户2、近2个月注册未购物的客户；券200减50',57255,'2011-09-13',50,'pj19' from smssndmst where smsid=263

--全场
insert into smssnddtl (smsid,phone,mbrid,name,ifsend) 
select DISTINCT 125,odrmst_rphone,max(odrmst_mbrid),max(odrmst_rname),-1 
from  odrmst
where len(odrmst_rphone)=11 and (odrmst_rphone like '13%' or odrmst_rphone like '15%' or odrmst_rphone like '18%') 
and odrmst_mbrid not in(select mbrmstpingan_mbrid from mbrmstpingan) 
and odrmst_mbrid not in (202828)
and odrmst_orderstatus in (3,31,5,51,6,61) and odrmst_rphone not in(select phone from badsms) 
group by odrmst_rphone 

select count(*) from smssnddtl where ifsend=-1
