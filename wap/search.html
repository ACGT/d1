<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<title>D1优尚网触屏版</title>
<meta name="author" content="m.d1.cn">
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<link rel="stylesheet" type="text/css" href="/res/wap/css/base.css"
	charset="utf-8" />
<link rel="stylesheet" type="text/css"
	href="/res/wap/css/result.css?1.32" charset="utf-8" />
<script type="text/javascript" src="/res/wap/js/jquery-1.7.min.js"></script>
<script type="text/javascript" src="/res/wap/js/com.js"></script>
</head>
<body>
	<header class="p_header">
		<a name="top"></a>
		<div class="h_txt">
			<div class="pageback">
				<a href="javascript:window.history.back(-1);">返回</a>
			</div>
			<div class="search">
				<input type="submit" class="sbut" text="搜索" name="sbut" id="sbut" />
				<input name="keyword" id="keyword" autocomplete="off"
					role="combobox" aria-haspopup="true" type="text" class="keys" />
			</div>
			<div class="home">
				<a href="/wap/index.html"></a>
			</div>
			<div class="myuser">
				<a href="/wap/user/index.html"></a>
			</div>
			<div class="carth">
				<a href="/wap/flow.html"></a>
			</div>
		</div>
	</header>
	<div class="main">
		<div class="rck">
			<div class="rckitem"></div>
		</div>
		<div class="m_plist">
			<div class="mp_sort">
				<div class="mps_con">
					<div class="mpsc_txt">
						<a href="javascript:void(0)" attr="3" class="cur">销量</a> <a
							href="javascript:void(0)" attr="2">价格</a> <a
							href="javascript:void(0)" attr="5">上架时间</a>
					</div>
				</div>
			</div>
			<div class="mp_list">
				<ul>

				</ul>
				<div class="m_page">
					<div class="mp_cell s">首页</div>
					<div class="mp_cell l">上一页</div>
					<div class="mp_cell m">
						<span class="vselect">&nbsp;<i></i></span> <select
							class="go_select" onchange="gourl(this.value);">
						</select>
					</div>
					<div class="mp_cell r">下一页</div>
					<div class="mp_cell e">尾页</div>
				</div>
			</div>
			<div class="mp_err"></div>
		</div>
	</div>
	<div id="footer" class="footer">
		<script language="javascript">
					getwapFoot();
				   </script>
	</div>
	<script language="javascript">

function loaddata(rackcode1,order1,pageno1){
	
  var url=document.URL;
  var para="";
  var pageno=1;
  var rackcode="";
  var order="";
  var key="";
  var hskey="";
   if(url.lastIndexOf("?")>0)
   {
        para=url.substring(url.lastIndexOf("?")+1,url.length);
		var arr=para.split("&");
		para="";
		for(var i=0;i<arr.length;i++)
		{
		   if(arr[i].split("=")[0]=="pageno"){
			   pageno=arr[i].split("=")[1];
		   }else if(arr[i].split("=")[0]=="rackcode"){
			   rackcode=arr[i].split("=")[1];
		   }else if(arr[i].split("=")[0]=="order"){
			   order=arr[i].split("=")[1];
		   }else if(arr[i].split("=")[0]=="key_wds"){
			   key=arr[i].split("=")[1];
		   }else if(arr[i].split("=")[0]=="headsearchkey"){
			   hskey=arr[i].split("=")[1];
		   }
		}
   }
   if(rackcode1!=""){
		  rackcode=rackcode1
   }
	if(order1!=""){
		order=order1;
	  }
	if(pageno1!=""){
		pageno=pageno1;
		}
	

  if((key==null||key.length==0)&&(hskey==null||hskey.length==0)){
	  $(".mp_list").hide();
	  $(".mp_err").html("搜索关键词不能为空！")
  }
 
	var psize=12;
	  $.ajax({
		type: 'get', 
        url: '/ajax/wap/getsearch.jsp',
        data:{headsearchkey:hskey,key_wds:key,pageno:pageno,rackcode:rackcode,order:order,psize:psize},
		dataType:'json',
		success: function(data){
				/*处理数据*/
			 if(key==null||key.length==0){
				 key=  hskey;
			  }
				if(data.status=="1"){
				showlist(key,data,psize,pageno,rackcode,order);
				}else if(data.status=="2"){
					window.location.href=data.gourl;
				}
        }
	});
	}

	function gourl(parr){
		c=parr.split(",");
		var gourl="search.html?key_wds="+c[0]+"";
		if(c[1].length>0){
			gourl+="&rackcode="+c[1]+"";
		}
		if(c[2].length>0){
			gourl+="&order="+c[2]+"";
		}
		if(c[3].length>0){
			gourl+="&pageno="+c[3]+"";
		}
		window.location.href=gourl;
	}
	function showlist(key,p,psize,pageno,rackcode,order){
		
		var rcklists=eval(p.racks);
		var catehtml="";
		$(".rck").html('');
		if(rcklists.length>0){
		   for(var k=0;k<rcklists.length;k++){
			   var rckstr=
			   catehtml=catehtml+' <div class="rckitem"><a  href="javascript:void(0)" class="m">'+rcklists[k].mrackname;+'</a>';
			   var rckstr=rcklists[k].mrackitems;
	      		var rcks=eval(rckstr);
	      		var rckcount=rcks.length;
	      		for(var l=0;l<rckcount;l++){
			   catehtml=catehtml+' <a attr="'+key+','+rcks[l].drackcode+','+order+',1" href="javascript:void(0)">'+rcks[l].drackname+'</a>';
	      		}
	      		catehtml=catehtml+'</div>';
	      	}
		   $(".rck").append(catehtml);
		}
		
		
		var pagenum=parseInt(p.page_total/psize);
		if(p.page_total%psize>0) {
			pagenum=pagenum+1;
	     }
		$(".vselect").html(pageno+'/'+pagenum+'&nbsp;<i></i>');
		 var pgnext=parseInt(pageno)+1;
		 var pgup=parseInt(pageno)-1;
		$(".m_page .mp_cell.s").html('<a attr="'+key+','+rackcode+','+order+',1" href="javascript:void(0)">首页</a>');
		if(parseInt(pgup)>=1){
		$(".m_page .mp_cell.l").html('<a attr="'+key+','+rackcode+','+order+','+ pgup+'" href="javascript:void(0)">上一页</a>');
		}else{
			$(".m_page .mp_cell.l").hide();
		}
		 if(parseInt(pgnext)<=parseInt(pagenum)){
		$(".m_page .mp_cell.r").html('<a attr="'+key+','+rackcode+','+order+','+pgnext+'" href="javascript:void(0)">下一页</a>');
		 }else{
				$(".m_page .mp_cell.r").hide();
			}
		$(".m_page .mp_cell.e").html('<a attr="'+key+','+rackcode+','+order+','+pagenum+'" href="javascript:void(0)">尾页</a>');
		
		pageselect="";
		for(var i=1;i<=pagenum;i++){
			if(i==pageno){
			pageselect+='<option value="'+key+','+rackcode+','+order+','+i+'" selected>第'+i+'页</option>';
			}else{
			pageselect+='<option value="'+key+','+rackcode+','+order+','+i+'">第'+i+'页</option>';	
			}
		}
		$(".go_select").html(pageselect);
		

	var products=eval(p.products);
	$(".mp_list ul").html('');
	if(products.length>0){
		var pli="";
	   for(var i=0;i<products.length;i++){
		  var pprice=products[i].p_mprice;
		  if(products[i].p_issgflag||products[i].p_ismiaoshao){
			  pprice=products[i].p_msprice;
		  }
		  var zk=(pprice*10.0/products[i].p_saleprice).toFixed(1);
		pli='<li>';
		pli+='<div class="iteml"><a href="product.html?id='+products[i].p_gdsid+'"><img src="'+products[i].p_img+'" border="0"></a></div>';
		pli+='	  <div class="itemr">';
		pli+='	      <span class="title"><a href="product.html?id='+products[i].p_gdsid+'">'+products[i].p_gdsname+'</a></span>';
		if(products[i].p_acttxt!=''){
			pli+='		 <div class="ptxt">';
			pli+='			 <span class="phot"><font color="red">'+ products[i].p_acttxt+'</font></span>';
			pli+='		  </div>';
			}
		pli+='		  <div class="ptxt">';
		pli+='		     <span class="pm">￥'+pprice+'</span>';
		pli+='			 <span class="ps">￥<s>'+products[i].p_saleprice+'</s></span>';
		pli+='		  </div>';
		if(products[i].p_shopcode=='00000000'){
			pli+='		 <div class="ptxt">';
			pli+='			 <span class="phot"><font color="red">D1优尚自营产品 </font></span>';
			pli+='		  </div>';
			}
		pli+='	  </div>';
		pli+='  </li>';
	   $(".mp_list ul").append(pli);
	   }

	  
	}
	$(".rckitem>a").click(function(){
		var paras=$(this).attr('attr');
		gourl(paras)
		
	});

	$(".m_page .mp_cell>a").click(function(){
		var paras=$(this).attr('attr');
		gourl(paras)
		
	});
	   /*orderContent
   case 6://热销商品升
case 5 ://上架时间升
case 4 ://上架时间降
	case 3://热销商品
	case 2://价格，升序
	case 1://价格，倒序*/
$(".mpsc_txt>a").click(function(){
			$(".mpsc_txt>a").removeClass("cur");

			$(this).addClass("cur");
			var corder=$(this).attr('attr');
			if(this.attr=='1'){
				this.attr='2'
			}else if(this.attr=='2'){
				this.attr='1'
			}
			
			loaddata(rackcode,corder,pageno);
	});
	}
	loaddata('','','');
	$("#sbut").click(function(){
		var headsearchkey =$("#keyword").val();
		 window.location.href="/wap/search.html?headsearchkey="+headsearchkey;
	});

	</script>
	<div style="display: none;">
		<script language="javascript">
	var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
	document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F46dd49a8ff1d96b258ddf6588110099c' type='text/javascript'%3E%3C/script%3E"));

	</script>
	</div>
</body>
</html>